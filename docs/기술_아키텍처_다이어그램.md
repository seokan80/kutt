# Kutt URL Shortener ê¸°ìˆ  ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œìš”

### 1. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```mermaid
graph TB
    User[ğŸ‘¤ ì‚¬ìš©ì] --> LB[ğŸ”§ ë¡œë“œ ë°¸ëŸ°ì„œ]
    API[ğŸ“± API í´ë¼ì´ì–¸íŠ¸] --> LB
    
    LB --> App1[ğŸ–¥ï¸ Kutt App ì¸ìŠ¤í„´ìŠ¤ 1]
    LB --> App2[ğŸ–¥ï¸ Kutt App ì¸ìŠ¤í„´ìŠ¤ 2]
    LB --> AppN[ğŸ–¥ï¸ Kutt App ì¸ìŠ¤í„´ìŠ¤ N]
    
    App1 --> DB[(ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤)]
    App2 --> DB
    AppN --> DB
    
    App1 --> Redis[(ğŸ”„ Redis ìºì‹œ)]
    App2 --> Redis
    AppN --> Redis
    
    App1 --> Queue[ğŸ“® ì‘ì—… í]
    App2 --> Queue
    AppN --> Queue
    
    Queue --> Worker[âš™ï¸ ë°±ê·¸ë¼ìš´ë“œ ì›Œì»¤]
    Worker --> SMTP[ğŸ“§ SMTP ì„œë²„]
```

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ êµ¬ì¡°

```mermaid
graph LR
    subgraph "Express.js ì• í”Œë¦¬ì¼€ì´ì…˜"
        Router[ë¼ìš°í„°] --> Middleware[ë¯¸ë“¤ì›¨ì–´]
        Middleware --> Handler[í•¸ë“¤ëŸ¬]
        Handler --> Model[ëª¨ë¸]
        Model --> DB[(ë°ì´í„°ë² ì´ìŠ¤)]
        
        Handler --> Queue[ì‘ì—… í]
        Handler --> Cache[ìºì‹œ]
    end
    
    Client[í´ë¼ì´ì–¸íŠ¸] --> Router
```

## ë°ì´í„° í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

### 1. URL ë‹¨ì¶• í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant C as í´ë¼ì´ì–¸íŠ¸
    participant A as Kutt App
    participant V as ê²€ì¦ê¸°
    participant D as ë°ì´í„°ë² ì´ìŠ¤
    participant R as Redis
    
    C->>A: POST /api/links (ì›ë³¸ URL)
    A->>V: ì…ë ¥ ê²€ì¦
    V->>A: ê²€ì¦ ì™„ë£Œ
    A->>D: ì¤‘ë³µ ì£¼ì†Œ í™•ì¸
    D->>A: í™•ì¸ ê²°ê³¼
    A->>D: ë§í¬ ì €ì¥
    D->>A: ì €ì¥ ì™„ë£Œ
    A->>R: ìºì‹œ ì €ì¥
    A->>C: ë‹¨ì¶• URL ë°˜í™˜
```

### 2. URL ë¦¬ë””ë ‰ì…˜ í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant A as Kutt App
    participant R as Redis
    participant D as ë°ì´í„°ë² ì´ìŠ¤
    participant Q as ì‘ì—… í
    participant W as ì›Œì»¤
    
    U->>A: GET /:shortCode
    A->>R: ìºì‹œì—ì„œ ë§í¬ ì¡°íšŒ
    alt ìºì‹œ íˆíŠ¸
        R->>A: ë§í¬ ì •ë³´ ë°˜í™˜
    else ìºì‹œ ë¯¸ìŠ¤
        A->>D: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ
        D->>A: ë§í¬ ì •ë³´ ë°˜í™˜
        A->>R: ìºì‹œì— ì €ì¥
    end
    
    A->>Q: ë°©ë¬¸ ê¸°ë¡ ì‘ì—… íì— ì¶”ê°€
    A->>U: ì›ë³¸ URLë¡œ ë¦¬ë””ë ‰ì…˜
    
    Q->>W: ë°©ë¬¸ ê¸°ë¡ ì²˜ë¦¬
    W->>D: ë°©ë¬¸ í†µê³„ ì €ì¥
```

### 3. ì‚¬ìš©ì ì¸ì¦ í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant C as í´ë¼ì´ì–¸íŠ¸
    participant A as Kutt App
    participant P as Passport.js
    participant D as ë°ì´í„°ë² ì´ìŠ¤
    participant J as JWT
    
    C->>A: POST /api/auth/login
    A->>P: ì¸ì¦ ìš”ì²­
    P->>D: ì‚¬ìš©ì ì¡°íšŒ
    D->>P: ì‚¬ìš©ì ì •ë³´
    P->>P: ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
    P->>A: ì¸ì¦ ê²°ê³¼
    A->>J: JWT í† í° ìƒì„±
    A->>C: í† í° ë°˜í™˜
```

## ì»´í¬ë„ŒíŠ¸ ìƒí˜¸ì‘ìš© ë‹¤ì´ì–´ê·¸ë¨

### 1. í•¸ë“¤ëŸ¬ ë ˆì´ì–´ êµ¬ì¡°

```mermaid
graph TB
    subgraph "í•¸ë“¤ëŸ¬ ë ˆì´ì–´"
        AuthH[auth.handler.js<br/>ì¸ì¦ ê´€ë¦¬]
        LinksH[links.handler.js<br/>ë§í¬ ê´€ë¦¬]
        UsersH[users.handler.js<br/>ì‚¬ìš©ì ê´€ë¦¬]
        DomainsH[domains.handler.js<br/>ë„ë©”ì¸ ê´€ë¦¬]
        ValidH[validators.handler.js<br/>ì…ë ¥ ê²€ì¦]
        HelpersH[helpers.handler.js<br/>í—¬í¼ í•¨ìˆ˜]
    end
    
    subgraph "ëª¨ë¸ ë ˆì´ì–´"
        UserM[user.model.js]
        LinkM[link.model.js]
        DomainM[domain.model.js]
        VisitM[visit.model.js]
    end
    
    AuthH --> UserM
    LinksH --> LinkM
    LinksH --> VisitM
    UsersH --> UserM
    DomainsH --> DomainM
```

### 2. ë¼ìš°íŒ… êµ¬ì¡°

```mermaid
graph LR
    subgraph "ë¼ìš°í„°"
        MainR[routes.js<br/>ë©”ì¸ ë¼ìš°í„°]
        AuthR[auth.routes.js<br/>ì¸ì¦ ë¼ìš°í„°]
        LinkR[link.routes.js<br/>ë§í¬ ë¼ìš°í„°]
        UserR[user.routes.js<br/>ì‚¬ìš©ì ë¼ìš°í„°]
        DomainR[domain.routes.js<br/>ë„ë©”ì¸ ë¼ìš°í„°]
        RenderR[renders.routes.js<br/>ë Œë”ë§ ë¼ìš°í„°]
    end
    
    MainR --> AuthR
    MainR --> LinkR
    MainR --> UserR
    MainR --> DomainR
    MainR --> RenderR
```

## ë°ì´í„°ë² ì´ìŠ¤ ERD

```mermaid
erDiagram
    users {
        int id PK
        string email UK
        string password
        enum role
        string apikey
        boolean banned
        boolean verified
        datetime created_at
        datetime updated_at
    }
    
    links {
        int id PK
        string address UK
        string target
        string description
        string password
        datetime expire_in
        int user_id FK
        int domain_id FK
        int visit_count
        boolean banned
        uuid uuid
        datetime created_at
        datetime updated_at
    }
    
    visits {
        int id PK
        int link_id FK
        int user_id FK
        string ip_hash
        string country
        string referrer
        string browser
        string os
        datetime created_at
    }
    
    domains {
        int id PK
        string address UK
        string homepage
        int user_id FK
        boolean banned
        datetime created_at
        datetime updated_at
    }
    
    users ||--o{ links : "ì†Œìœ "
    users ||--o{ domains : "ì†Œìœ "
    users ||--o{ visits : "ë°©ë¬¸"
    links ||--o{ visits : "ë°©ë¬¸ ê¸°ë¡"
    domains ||--o{ links : "ì‚¬ìš©"
```

## ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 1. ì¸ì¦ ë° ì¸ê°€ í”Œë¡œìš°

```mermaid
graph TB
    Request[HTTP ìš”ì²­] --> Helmet[Helmet ë³´ì•ˆ í—¤ë”]
    Helmet --> CORS[CORS ì •ì±…]
    CORS --> RateLimit[Rate Limiting]
    RateLimit --> Auth{ì¸ì¦ í•„ìš”?}
    
    Auth -->|Yes| JWT[JWT ê²€ì¦]
    Auth -->|Yes| APIKey[API í‚¤ ê²€ì¦]
    JWT --> Role{ì—­í•  í™•ì¸}
    APIKey --> Role
    
    Role -->|User| UserHandler[ì‚¬ìš©ì í•¸ë“¤ëŸ¬]
    Role -->|Admin| AdminHandler[ê´€ë¦¬ì í•¸ë“¤ëŸ¬]
    Auth -->|No| PublicHandler[ê³µê°œ í•¸ë“¤ëŸ¬]
```

### 2. ë°ì´í„° ë³´í˜¸ ë ˆì´ì–´

```mermaid
graph LR
    subgraph "ì…ë ¥ ë°ì´í„°"
        Input[ì‚¬ìš©ì ì…ë ¥]
    end
    
    subgraph "ê²€ì¦ ë ˆì´ì–´"
        Validator[express-validator]
        Sanitizer[ë°ì´í„° ì •ì œ]
    end
    
    subgraph "ì €ì¥ ë ˆì´ì–´"
        Hash[ë¹„ë°€ë²ˆí˜¸ í•´ì‹±]
        Encrypt[ë¯¼ê° ë°ì´í„° ì•”í˜¸í™”]
        DB[(ë°ì´í„°ë² ì´ìŠ¤)]
    end
    
    Input --> Validator
    Validator --> Sanitizer
    Sanitizer --> Hash
    Hash --> Encrypt
    Encrypt --> DB
```

## ì„±ëŠ¥ ìµœì í™” êµ¬ì¡°

### 1. ìºì‹± ì „ëµ

```mermaid
graph TB
    Request[ìš”ì²­] --> Cache{Redis ìºì‹œ}
    Cache -->|Hit| Return[ìºì‹œëœ ë°ì´í„° ë°˜í™˜]
    Cache -->|Miss| DB[(ë°ì´í„°ë² ì´ìŠ¤)]
    DB --> Store[ìºì‹œì— ì €ì¥]
    Store --> Return
    
    subgraph "ìºì‹œ í‚¤ ì „ëµ"
        LinkCache[ë§í¬ ìºì‹œ: link:address]
        UserCache[ì‚¬ìš©ì ìºì‹œ: user:id]
        StatsCache[í†µê³„ ìºì‹œ: stats:link:id]
    end
```

### 2. ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬

```mermaid
graph LR
    Request[HTTP ìš”ì²­] --> Handler[í•¸ë“¤ëŸ¬]
    Handler --> Response[ì¦‰ì‹œ ì‘ë‹µ]
    Handler --> Queue[ì‘ì—… í]
    
    Queue --> Worker1[ì›Œì»¤ 1]
    Queue --> Worker2[ì›Œì»¤ 2]
    Queue --> WorkerN[ì›Œì»¤ N]
    
    Worker1 --> Email[ì´ë©”ì¼ ë°œì†¡]
    Worker2 --> Analytics[í†µê³„ ì²˜ë¦¬]
    WorkerN --> Cleanup[ì •ë¦¬ ì‘ì—…]
```

## ë°°í¬ ì•„í‚¤í…ì²˜

### 1. Docker ì»¨í…Œì´ë„ˆ êµ¬ì¡°

```mermaid
graph TB
    subgraph "Docker Compose"
        App[Kutt App Container]
        DB[Database Container]
        Redis[Redis Container]
        Nginx[Nginx Container]
    end
    
    subgraph "ë³¼ë¥¨"
        CustomVol[Custom í´ë”]
        DBVol[DB ë°ì´í„°]
        LogVol[ë¡œê·¸ íŒŒì¼]
    end
    
    App --> CustomVol
    DB --> DBVol
    App --> LogVol
    
    Nginx --> App
    App --> DB
    App --> Redis
```

### 2. ìŠ¤ì¼€ì¼ë§ êµ¬ì¡°

```mermaid
graph TB
    LoadBalancer[ë¡œë“œ ë°¸ëŸ°ì„œ] --> App1[Kutt ì¸ìŠ¤í„´ìŠ¤ 1]
    LoadBalancer --> App2[Kutt ì¸ìŠ¤í„´ìŠ¤ 2]
    LoadBalancer --> App3[Kutt ì¸ìŠ¤í„´ìŠ¤ 3]
    
    App1 --> MasterDB[(ë§ˆìŠ¤í„° DB)]
    App2 --> MasterDB
    App3 --> MasterDB
    
    MasterDB --> SlaveDB1[(ìŠ¬ë ˆì´ë¸Œ DB 1)]
    MasterDB --> SlaveDB2[(ìŠ¬ë ˆì´ë¸Œ DB 2)]
    
    App1 --> RedisCluster[Redis í´ëŸ¬ìŠ¤í„°]
    App2 --> RedisCluster
    App3 --> RedisCluster
```

## ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… êµ¬ì¡°

### 1. ë¡œê·¸ ìˆ˜ì§‘ í”Œë¡œìš°

```mermaid
graph LR
    App[Kutt App] --> FileLog[íŒŒì¼ ë¡œê·¸]
    App --> Console[ì½˜ì†” ë¡œê·¸]
    
    FileLog --> LogAgent[ë¡œê·¸ ì—ì´ì „íŠ¸]
    Console --> LogAgent
    
    LogAgent --> LogStore[(ë¡œê·¸ ì €ì¥ì†Œ)]
    LogStore --> Dashboard[ëŒ€ì‹œë³´ë“œ]
```

### 2. ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```mermaid
graph TB
    App[ì• í”Œë¦¬ì¼€ì´ì…˜] --> Metrics[ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸°]
    DB[(ë°ì´í„°ë² ì´ìŠ¤)] --> Metrics
    Redis[(Redis)] --> Metrics
    
    Metrics --> TSDB[(ì‹œê³„ì—´ DB)]
    TSDB --> Alert[ì•Œë¦¼ ì‹œìŠ¤í…œ]
    TSDB --> Grafana[Grafana ëŒ€ì‹œë³´ë“œ]
```

## API ìš”ì²­ ì²˜ë¦¬ í”Œë¡œìš°

### 1. RESTful API êµ¬ì¡°

```mermaid
graph TB
    Client[í´ë¼ì´ì–¸íŠ¸] --> Router[Express ë¼ìš°í„°]
    
    Router --> AuthMiddleware[ì¸ì¦ ë¯¸ë“¤ì›¨ì–´]
    AuthMiddleware --> ValidatorMiddleware[ê²€ì¦ ë¯¸ë“¤ì›¨ì–´]
    ValidatorMiddleware --> Handler[ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í•¸ë“¤ëŸ¬]
    
    Handler --> Model[ë°ì´í„° ëª¨ë¸]
    Model --> Database[(ë°ì´í„°ë² ì´ìŠ¤)]
    
    Handler --> Response[JSON ì‘ë‹µ]
    Response --> Client
```

### 2. ì—ëŸ¬ ì²˜ë¦¬ í”Œë¡œìš°

```mermaid
graph TB
    Error[ì—ëŸ¬ ë°œìƒ] --> ErrorType{ì—ëŸ¬ íƒ€ì…}
    
    ErrorType -->|ê²€ì¦ ì—ëŸ¬| ValidationError[400 Bad Request]
    ErrorType -->|ì¸ì¦ ì—ëŸ¬| AuthError[401 Unauthorized]
    ErrorType -->|ê¶Œí•œ ì—ëŸ¬| PermissionError[403 Forbidden]
    ErrorType -->|ë¦¬ì†ŒìŠ¤ ì—†ìŒ| NotFoundError[404 Not Found]
    ErrorType -->|ì„œë²„ ì—ëŸ¬| ServerError[500 Internal Server Error]
    
    ValidationError --> ErrorHandler[ì—ëŸ¬ í•¸ë“¤ëŸ¬]
    AuthError --> ErrorHandler
    PermissionError --> ErrorHandler
    NotFoundError --> ErrorHandler
    ServerError --> ErrorHandler
    
    ErrorHandler --> LogError[ì—ëŸ¬ ë¡œê¹…]
    ErrorHandler --> ErrorResponse[ì—ëŸ¬ ì‘ë‹µ]
```

ì´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì€ Kutt URL Shortenerì˜ ì „ì²´ì ì¸ ê¸°ìˆ  êµ¬ì¡°ì™€ ê° ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ì‹œê°ì ìœ¼ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì‹œìŠ¤í…œì˜ í™•ì¥ì„±, ë³´ì•ˆì„±, ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆì„ í¬í•¨í•˜ì—¬ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œì˜ êµ¬ì¡°ë¥¼ ë°˜ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.